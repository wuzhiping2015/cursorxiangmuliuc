# 通用型前端开发指令文档（Vue技术栈）

---

## 一、技术选型标准
### 1.1 核心框架
```markdown
- **Vue 版本**：  
  ✅ 主推 Vue 3 + Composition API + `<script setup>`  
  ✅ 兼容 Vue 2 + `@vue/composition-api`  
- **状态管理**：  
  🔵 Vue 3: Pinia（推荐 Store Setup 模式）  
  🟠 Vue 2: Vuex 4+（需配合模块化设计）  
- **路由方案**：Vue Router 4+（支持动态路由鉴权）  
- **构建工具**：Vite 4+（需配置 `@vitejs/plugin-vue2` 兼容旧版）
```

### 1.2 配套技术栈
```markdown
| 领域          | 技术方案                          | 关键特性                          |
|---------------|-----------------------------------|----------------------------------|
| **UI框架**    | Element Plus/Ant Design Vue      | 主题定制 + 按需加载              |
| **数据通信**  | Axios（封装拦截器）+ MQTT.js     | 支持REST/WebSocket双通道         |
| **可视化**    | ECharts 5 + Vue-Echarts          | 按需引入 + 响应式自适应          |
| **样式方案**  | Sass + PostCSS + Autoprefixer    | 变量集中管理 + CSS模块化         |
| **工具库**    | lodash + dayjs + mitt            | Tree-shaking优化                 |
```

---

## 二、工程架构规范
### 2.1 核心目录结构
```bash
src/
├── assets/              # 静态资源
│   ├── fonts/           # 字体文件
│   ├── images/          # 图片资源
│   └── styles/          # 全局样式文件
│       ├── base/        # 基础样式
│       │   ├── reset.css # 样式重置
│       │   └── typography.css # 排版样式
│       ├── components/  # 组件样式
│       │   ├── button.css # 按钮样式
│       │   └── input.css  # 输入框样式
│       ├── layout/      # 布局样式
│       │   ├── header.css # 头部样式
│       │   └── footer.css # 底部样式
│       └── themes/      # 主题样式
│           ├── light.css # 明亮主题
│           └── dark.css  # 暗黑主题
├── components/          # 组件
│   ├── atoms/           # 原子组件
│   │   ├── Button.vue   # 按钮组件
│   │   └── Input.vue    # 输入框组件
│   ├── molecules/       # 分子组件
│   │   ├── Card.vue     # 卡片组件
│   │   └── NavItem.vue  # 导航项组件
│   ├── organisms/       # 组织组件
│   │   ├── Header.vue   # 头部导航栏
│   │   └── Footer.vue   # 底部页脚
│   └── templates/       # 模板组件
│       ├── DashboardTemplate.vue # 数据大屏模板
│       └── DetailTemplate.vue    # 详情页模板
│   ├── CommonTable.vue  # 通用表格组件
│   ├── CommonForm.vue   # 通用表单组件
├── pages/               # 页面
│   ├── Dashboard.vue    # 数据大屏主页面
│   └── ToolDetail.vue   # 工具详情页
├── composables/         # 逻辑复用
│   ├── useChartData.js  # 数据处理 Hook
│   ├── useTheme.js      # 主题切换 Hook
│   └── useResize.js     # 窗口调整大小 Hook
├── services/            # API 请求服务
│   ├── apiClient.js     # Axios 实例配置
│   ├── toolService.js   # 工具相关的 API 请求
│   ├── userService.js   # 用户相关的 API 请求
│   └── commonApi.js     # 通用接口封装
├── stores/              # Pinia 状态管理
│   ├── index.js         # Pinia store 初始化
│   ├── modules/         # 各个模块的状态管理
│   │   ├── toolStore.js # 工具状态管理
│   │   └── userStore.js # 用户状态管理
├── utils/               # 工具函数
│   ├── formatDate.js    # 日期格式化工具
│   ├── debounce.js      # 防抖函数
│   └── throttle.js      # 节流函数
├── router/              # Vue Router 路由配置
│   └── index.js         # 路由配置文件
├── plugins/             # 插件
│   ├── echartsPlugin.js # ECharts 插件
│   └── piniaPlugin.js   # Pinia 插件
├── main.js              # 应用入口文件
└── App.vue              # 根组件
```

### 2.2 代码质量管控
```markdown
- **静态检查**：  
  🔹 ESLint：`plugin:vue/vue3-essential`  
  🔹 Prettier：2空格缩进 + 单引号 + 尾随逗号  
- **注释规范**：  
  ✅ 组件头部需包含 `@name` `@description`  
  ✅ 复杂逻辑需添加 `@logic` 流程图链接
```

---

## 三、核心组件规范
### 3.1 智能数据表格
```markdown
- **核心能力**：  
  🔹 动态列配置（JSON Schema驱动）  
  🔹 虚拟滚动（支持10W+数据）  
  🔹 内置分页/排序/过滤/列冻结  
- **代码示例**：  
  ```vue
  <SmartTable
    :schema="tableConfig"
    :load-data="fetchData"
    @row-click="handleRowEvent"
  >
    <template #action="{ row }">
    </template>
  </SmartTable>
  ```
- **性能优化**：  
  ✅ 列配置深比较（`fast-deep-equal`）  
  ✅ 分块渲染（`requestIdleCallback`）
```

### 3.2 动态表单引擎
```markdown
- **核心特性**：  
  🔹 JSON Schema驱动表单生成  
  🔹 支持50+内置控件类型  
  🔹 跨字段联动验证（`async-validator`）  
- **状态管理**：  
  ```javascript
  const formEngine = useForm({
    schema: formSchema,
    layout: 'grid', // 支持响应式布局
    submit: handleSubmit
  })
  ```
- **扩展机制**：  
  ✅ 自定义控件注册系统  
  ✅ 表单主题插件化
```

### 3.3 通用表格组件
```markdown
- **核心功能**：
  🔹 支持多种数据格式的展示
  🔹 可配置列头、列宽、排序规则等
  🔹 提供分页、筛选等功能

- **代码示例**：
```vue
<CommonTable
  :data="tableData"
  :columns="tableColumns"
  :pagination="pagination"
  @page-change="handlePageChange"
/>
```
```

### 3.4 通用表单组件
```markdown
- **核心功能**：
  🔹 支持根据JSON Schema动态生成表单
  🔹 提供表单验证、提交等功能

- **代码示例**：
```vue
<CommonForm
  :schema="formSchema"
  :formData="formData"
  @submit="handleFormSubmit"
/>
```
```

---

## 四、通信机制设计
### 4.1 组件通信矩阵
```markdown
| 场景              | 方案                          | 典型应用                  |
|-------------------|-------------------------------|--------------------------|
| 父子组件          | props/emit + v-model          | 表单控件双向绑定          |
| 跨层级            | provide/inject + reactive     | 主题切换/多语言          |
| 全局事件          | Mitt事件总线                  | 通知中心/日志系统        |
| 状态共享          | Pinia/Vuex Store              | 用户信息/系统配置        |
| 实时数据          | MQTT over WebSocket           | 监控大屏/即时消息        |
| 通用表格与表单    | Mitt事件总线                  | 表格选中数据传递到表单   |
```

### 4.2 Mitt事件总线实践
```javascript
// 初始化总线
const emitter = mitt()

// 统一事件格式
function EventPayload(event, data) {
  return {
    event,
    timestamp: Date.now(),
    data
  }
}

// 安全监听
function listen(event, handler) {
  emitter.on(event, handler)
  onUnmounted(() => emitter.off(event, handler))
}
```

### 4.3 MQTT实时通道
```markdown
- **连接配置**：  
  ```javascript
  const mqttClient = mqtt.connect(WS_URL, {
    clientId: `CLIENT_${crypto.randomUUID()}`,
    keepalive: 30,
    protocolVersion: 5
  })
  ```
- **主题管理**：  
  ✅ QoS 1 + 持久会话  
  ✅ 自动重连 + 心跳检测  
- **最佳实践**：  
  🔹 使用Web Worker处理消息队列  
  🔹 消息压缩（`pako`库Gzip压缩）
```

### 4.4 通用表格与表单通信示例
```javascript
// 在表格组件中发送事件
emitter.emit('table-row-selected', selectedRowData)

// 在表单组件中监听事件
listen('table-row-selected', (data) => {
  // 将选中的数据填充到表单中
  formData.value = data
})
```

---

## 五、接口调用封装及示例
### 5.1 通用接口调用封装
在 `services/commonApi.js` 中进行通用接口调用的封装：
```javascript
import axios from 'axios';

// 创建axios实例
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL, // api的base_url
  timeout: 5000 // 请求超时时间
});

// 请求拦截器
service.interceptors.request.use(
  config => {
    // 在发送请求之前做些什么，例如添加token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
  },
  error => {
    // 处理请求错误
    console.log(error);
    Promise.reject(error);
  }
);

// 响应拦截器
service.interceptors.response.use(
  response => {
    // 对响应数据做点什么
    return response.data;
  },
  error => {
    // 处理响应错误
    console.log('err' + error);
    return Promise.reject(error);
  }
);

// 通用get请求方法
export function get(url, params = {}) {
  return service({
    url,
    method: 'get',
    params
  });
}

// 通用post请求方法
export function post(url, data = {}) {
  return service({
    url,
    method: 'post',
    data
  });
}
```

### 5.2 接口调用例子
在某个组件中调用接口：
```vue
<template>
  <div>
    <button @click="fetchData">获取数据</button>
    <button @click="submitData">提交数据</button>
  </div>
</template>

<script setup>
import { get, post } from '@/services/commonApi';

const fetchData = async () => {
  try {
    const response = await get('/api/data');
    console.log('获取的数据：', response);
  } catch (error) {
    console.error('获取数据失败：', error);
  }
};

const submitData = async () => {
  const data = {
    name: 'test',
    age: 20
  };
  try {
    const response = await post('/api/submit', data);
    console.log('提交数据成功：', response);
  } catch (error) {
    console.error('提交数据失败：', error);
  }
};
</script>
```

---

## 五、性能优化策略
### 5.1 框架级优化
```markdown
- **组件优化**：  
  ✅ `v-memo` 缓存静态节点  
  ✅ 动态组件 `defineAsyncComponent`  
- **状态管理**：  
  🔹 Pinia严格模式（`strict: true`）  
  🔹 Vuex模块惰性加载  
- **资源加载**：  
  ✅ 路由级代码分割（`import() + Suspense`）  
  ✅ 预加载关键资源（`vite-plugin-html`）
```

### 5.2 深度性能优化
```markdown
| 指标           | 优化手段                      | 目标值              |
|----------------|------------------------------|---------------------|
| FCP            | 关键CSS内联 + 字体预加载     | <1s                 |
| LCP            | 图片懒加载 + WebP格式        | <2.5s               |
| 交互延迟       | 防抖/节流 + Web Worker       | <100ms              |
| 内存占用       | 虚拟列表 + 对象池复用        | <300MB             |
```

---

## 六、安全与权限
### 6.1 安全防护
```markdown
- **请求安全**：  
  ✅ CSRF Token自动注入  
  ✅ 敏感操作二次验证  
  ✅ 请求参数XSS过滤  
- **内容安全**：  
  🔹 CSP策略配置  
  🔹 富文本DOMPurify过滤
```

### 6.2 权限体系
```markdown
- **路由鉴权**：  
  ```javascript
  router.beforeEach((to) => {
    if (to.meta.requiresAuth && !store.isLoggedIn) 
      return '/login'
  })
  ```
- **动态菜单**：  
  ✅ 基于角色过滤导航项  
  ✅ 按钮级权限指令 `v-permission`
```

---

## 七、扩展与维护
### 7.1 插件开发
```javascript
// 主题插件示例
export default {
  install: (app, themeConfig) => {
    const theme = reactive(themeConfig)
    app.provide('theme', theme)
    
    watch(theme, (val) => {
      document.documentElement.setAttribute('data-theme', val.mode)
    }, { immediate: true })
  }
}
```

### 7.2 版本迭代策略
```markdown
- **分支管理**：  
  ✅ `main` 分支：生产环境  
  ✅ `dev` 分支：集成测试  
  ✅ `feature/*`：功能开发  
- **发布流程**：  
  1. 代码扫描（SonarQube）  
  2. E2E测试（Cypress）  
  3. 容器化构建（Docker）  
  4. 蓝绿部署（Kubernetes）
```

---

## 八、监控与调试
### 8.1 前端监控
```markdown
- **关键指标**：  
  ✅ 错误率（Sentry捕获）  
  ✅ 性能指标（Web Vitals）  
  ✅ 用户行为（点击流分析）  
- **调试工具**：  
  🔹 Vue Devtools 6+  
  🔹 Performance录制分析
```

### 8.2 日志规范
```javascript
// 分级日志系统
const logger = {
  debug: (msg) => console.debug(`[DEBUG] ${msg}`),
  info: (msg) => console.info(`%c[INFO] ${msg}`, 'color: #1890ff'),
  error: (msg) => console.error(`[ERROR] ${msg}`)
}
```

---

## 九、文档配套
```markdown
- **必备文档**：  
  1. `ARCHITECTURE.md` 架构设计文档  
  2. `COMPONENT-API.md` 组件文档（Storybook驱动）  
  3. `DEPLOYMENT.md` 部署手册  
  4. `TROUBLESHOOTING.md` 故障排查指南  
- **文档标准**：  
  ✅ Markdown格式 + Mermaid流程图  
  ✅ 版本变更记录（CHANGELOG）
```

--- 

该文档特点：  
1. **框架兼容**：完整覆盖Vue2/3技术方案  
2. **生产就绪**：包含性能/安全/监控等生产级要求  
3. **扩展友好**：插件化架构支持渐进增强  
4. **工程化深度**：从开发到部署全流程规范  

使用建议：  
- 初始化项目时复制核心目录结构  
- 开发过程中参考组件/通信规范  
- 迭代时遵循版本管理策略  
- 上线前核查性能/安全清单